<!DOCTYPE html>
<html lang="en">
<head>
  <title>Liquid Forms - Connection Required</title>

  <meta charset="utf-8">
  <meta name="author" content="Zach Moazeni">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/css/main.min.css?v=4" media="screen" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700" rel="stylesheet">
  <link rel="alternate" type="application/atom+xml" title="Connection Required" href="/feed/atom/" />
</head>
<body>
  <header>
    <nav class="row align-center">
      <div class="small-12 columns">
        <a class="brand text-center" href="/"><svg id="svg3542" height="21.913mm" width="168.74mm" version="1.1" viewBox="0 0 597.91431 77.643914">
 <defs id="defs3544">
  <filter id="filter6021" style="color-interpolation-filters:sRGB">
   <feFlood id="feFlood6023" result="flood" flood-opacity=".49804" flood-color="rgb(0,0,0)"/>
   <feComposite id="feComposite6025" operator="in" result="composite1" in2="SourceGraphic" in="flood"/>
   <feGaussianBlur id="feGaussianBlur6027" stdDeviation="3" result="blur" in="composite1"/>
   <feOffset id="feOffset6029" result="offset" dx="6" dy="6"/>
   <feComposite id="feComposite6031" operator="over" result="composite2" in2="offset" in="SourceGraphic"/>
  </filter>
 </defs>
 <g id="layer1" transform="translate(-623.9 295.03)">
  <g id="g6014" transform="translate(-153.57 1274.5)" filter="url(#filter6021)">
   <text id="text3365-6-5-6" style="word-spacing:0px;letter-spacing:0px" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="824.00177" font-family="&apos;Open Sans&apos;" xml:space="preserve"><tspan id="tspan3373-3-1-62" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="824.00177" font-family="&apos;Open Sans&apos;">Connec   ion </tspan></text>
   <path id="path3395-8-6-2-7" d="m1031.5-1538.9-15.848 0.076c-0.3921 0-0.6466-0.5346-0.4683-0.9871l8.7598-22.221c0.2634-0.6681-0.3814-1.314-0.8142-0.8157l-27.274 31.402c-0.35829 0.4126-0.13598 1.1803 0.34336 1.1855l14.468 0.1604c0.3772 0 0.6274 0.508 0.4739 0.9545l-7.3598 21.41c-0.2282 0.6636 0.3997 1.2649 0.8225 0.7874l27.243-30.763c0.3656-0.4127 0.139-1.1922-0.346-1.1899z"/>
   <text id="text3365-9-6-9-7" style="word-spacing:0px;letter-spacing:0px" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="1120.1641" font-family="&apos;Open Sans&apos;" xml:space="preserve"><tspan id="tspan3373-5-4-7-6" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="1120.1641" font-family="&apos;Open Sans&apos;">Required</tspan></text>
  </g>
 </g>
</svg>
 <span>Connection Required</span></a>
      </div>

      <a href="#" class="about" data-toggle="offCanvas" onclick="return false">about</a>
    </nav>
  </header>

  <div class="off-canvas position-left" id="offCanvas" data-off-canvas data-transition="overlap">
    <div class="sidebar">
  <button class="close-button" aria-label="Close menu" type="button" data-close>
    <span aria-hidden="true">&times;</span>
  </button>

  <div class="row">
    <h2 class="columns">About Zach</h2>
  </div>

  <div class="row">
    <div class="columns">
      <div class="row">
        <p class="columns">Zach is a software developer who has worked on a range of projects. He currently writes Ruby by day for <a href="https://www.getharvest.com/">Harvest</a> and plays with other languages by night (currently Haskell, Scala, Clojure, and Rust). He knows how to laugh at himself and loves to ship software. He is a father of two wonderful kids and a husband to a fantastic wife.</p>
      </div>

      <div class="row">
        <p class="columns">
          <a href="mailto:zach.moazeni@gmail.com">email</a> ϟ <a href="https://github.com/zmoazeni">github</a> ϟ <a href="https://twitter.com/zmoazeni">twitter</a> ϟ <a href="https://www.linkedin.com/in/zmoazeni/">linkedin</a>
        </p>
      </div>

      <h3 class="row columns">Notable Projects</h3>

      <div class="row">
        <ul class="columns">
          <li><a href="http://zmoazeni.github.io/csscss/">csscss</a></li>
          <li><a href="http://zmoazeni.github.io/harvested/">harvested</a></li>
          <li><a href="http://zmoazeni.github.io/gitspective/">gitspective</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row columns">
    <img src="/uploads/me.jpg" alt="Picture of Zach" />
  </div>
</div>

  </div>

  <main class="off-canvas-content" data-off-canvas-content>
    
      <article>
        <div class="header">
          <div class="row">
            <h1 class="column">Liquid Forms</h1>
          </div>

          <div class="row">
            <p class="column"><time datetime="2007-08-25T22:44:39+00:00">2007-08-25</time></p>
          </div>
        </div>

        <div class="row align-left">
          <div class="column content">
            <p>A few weeks back I <a href="/2007/8/liquids-leaking-from-a-developer">wrote</a> about using liquid. In the article I mentioned that soon I would write about how we integrated forms.</p>

<p>I’ve been purposely stalling for two reasons. One, I’ve been extremely busy at work, and two, I’ve been wanting to clean up some code and provide some helpers, but that doesn’t look likely at least for some time.</p>

<p>Before I start, I need to give kudos to the Mephisto team for giving me a good launch pad in creating forms.</p>

<p>Here’s an example tag.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>##
# In some other file
##
class MyForm &lt; Liquid::Block
  # I typically include these to allow most of the html tag helpers
  include ActionView::Helpers::TagHelper
  include ActionView::Helpers::FormTagHelper
  include ActionView::Helpers::FormOptionsHelper

  def render(context)

    # In the controller, pass the model along with the registers to be accessed
    # from the tag
    @model = context.registers[:model]

    # this will contain side affects.
    context.stack do
      context["form"] = {
        "first" =&gt; text_field_tag("model[first_field]", @model.first_field, :id =&gt; "model_first_field"),
        "second" =&gt; text_field_tag("model[second_field]", @model.second_field, :id =&gt; "model_second_field"),

        # This is some helper method used to generate an html output of
        # the validation errors
        "errors" =&gt; generate_validation_errors(@model),
        "submit" =&gt; submit_tag("Submit Form")
      }
    end

    result &lt;&lt; %(
      &lt;form method="post" action="#{context.url_for(:controller =&gt; "some_controller", :action =&gt; "some_action")}"
        #{render_all(@nodelist, context)}
      &lt;/form&gt;
    )

    # this gets spit out to the view
    result
  end
end

##
# Somewhere in your config you need to register the tag
##
Liquid::Template.register_tag(:myform, MyForm)
</code></pre>
</div>

<p>The first thing to do is to create a tag that inherits from <code class="highlighter-rouge">Liquid::Block</code>, and override the <code class="highlighter-rouge">render</code>. Next notice add a hash to the <code class="highlighter-rouge">context</code>. This directly defines what the templater can use. Also notice <code class="highlighter-rouge">render_all</code> inside the generated <code class="highlighter-rouge">form</code>. This allows the tag to pass the buck further on whatever it wraps, and obviously is extremely important.</p>

<p>For the most part that’s it. The templater can then template a form similar to the following.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;div&gt;
  {% my_form %}
    {{ form.errors }}

    &lt;p&gt;
      &lt;label for="model_first_field"&gt;First Field&lt;/label&gt;
      {{ form.first }}
    &lt;/p&gt;

    &lt;p&gt;
      &lt;label for="model_second_field"&gt;Second Field&lt;/label&gt;
      {{ form.second }}
    &lt;/p&gt;

    &lt;p&gt;
      {{ form.submit }}
    &lt;/p&gt;
  {% end_my_form %}
&lt;/div&gt;
</code></pre>
</div>

<p>I think this is a pretty slick way of enabling templaters customization over the way forms are laid out structurally. Obviously there is a lot of room for improvement. Extracting more out of the tag to keep it dry. I’ve also thought about allowing filters to allow designers to manipulate all the other attributes of the elements like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
{{ form.first | html id:"new-id" class:"class_one class_two" style:"border: 1px solid"}}
...
</code></pre>
</div>

<p>I just haven’t had any time to devote to liquid since we closed the last project that used it three weeks ago.</p>

<p>Finally you’ll notice above that I’m calling <code class="highlighter-rouge">context.url_for</code>. That’s not something that’s baked into liquid, but something I monkey patched to provide the tags with Rails routes. It only expects that the controller gets passed as a register.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Liquid::Context
  def url_for(*options)
    @registers[:controller].send(:url_for, *options)
  end
end
</code></pre>
</div>

          </div>
        </div>
      </article>
    
  </main>

  <footer class="row align-center text-center">
    <p class="column">&copy; 2007-2018 Zach Moazeni</p>
  </footer>

  <script src="/js/main.min.js"></script>
</body>
</html>

