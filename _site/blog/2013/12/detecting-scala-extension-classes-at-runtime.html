<!DOCTYPE html>
<html lang="en">
<head>
  <title>Detecting Scala Extension Classes at Runtime - Connection Required</title>

  <meta charset="utf-8">
  <meta name="author" content="Zach Moazeni">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/css/main.min.css?v=4" media="screen" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700" rel="stylesheet">
  <link rel="alternate" type="application/atom+xml" title="Connection Required" href="/feed/atom/" />
</head>
<body>
  <header>
    <nav class="row align-center">
      <div class="small-12 columns">
        <a class="brand text-center" href="/"><svg id="svg3542" height="21.913mm" width="168.74mm" version="1.1" viewBox="0 0 597.91431 77.643914">
 <defs id="defs3544">
  <filter id="filter6021" style="color-interpolation-filters:sRGB">
   <feFlood id="feFlood6023" result="flood" flood-opacity=".49804" flood-color="rgb(0,0,0)"/>
   <feComposite id="feComposite6025" operator="in" result="composite1" in2="SourceGraphic" in="flood"/>
   <feGaussianBlur id="feGaussianBlur6027" stdDeviation="3" result="blur" in="composite1"/>
   <feOffset id="feOffset6029" result="offset" dx="6" dy="6"/>
   <feComposite id="feComposite6031" operator="over" result="composite2" in2="offset" in="SourceGraphic"/>
  </filter>
 </defs>
 <g id="layer1" transform="translate(-623.9 295.03)">
  <g id="g6014" transform="translate(-153.57 1274.5)" filter="url(#filter6021)">
   <text id="text3365-6-5-6" style="word-spacing:0px;letter-spacing:0px" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="824.00177" font-family="&apos;Open Sans&apos;" xml:space="preserve"><tspan id="tspan3373-3-1-62" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="824.00177" font-family="&apos;Open Sans&apos;">Connec   ion </tspan></text>
   <path id="path3395-8-6-2-7" d="m1031.5-1538.9-15.848 0.076c-0.3921 0-0.6466-0.5346-0.4683-0.9871l8.7598-22.221c0.2634-0.6681-0.3814-1.314-0.8142-0.8157l-27.274 31.402c-0.35829 0.4126-0.13598 1.1803 0.34336 1.1855l14.468 0.1604c0.3772 0 0.6274 0.508 0.4739 0.9545l-7.3598 21.41c-0.2282 0.6636 0.3997 1.2649 0.8225 0.7874l27.243-30.763c0.3656-0.4127 0.139-1.1922-0.346-1.1899z"/>
   <text id="text3365-9-6-9-7" style="word-spacing:0px;letter-spacing:0px" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="1120.1641" font-family="&apos;Open Sans&apos;" xml:space="preserve"><tspan id="tspan3373-5-4-7-6" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="1120.1641" font-family="&apos;Open Sans&apos;">Required</tspan></text>
  </g>
 </g>
</svg>
 <span>Connection Required</span></a>
      </div>

      <a href="#" class="about" data-toggle="offCanvas" onclick="return false">about</a>
    </nav>
  </header>

  <div class="off-canvas position-left" id="offCanvas" data-off-canvas data-transition="overlap">
    <div class="sidebar">
  <button class="close-button" aria-label="Close menu" type="button" data-close>
    <span aria-hidden="true">&times;</span>
  </button>

  <div class="row">
    <h2 class="columns">About Zach</h2>
  </div>

  <div class="row">
    <div class="columns">
      <div class="row">
        <p class="columns">Zach is a software developer who has worked on a range of projects. He currently writes Ruby by day for <a href="https://www.getharvest.com/">Harvest</a> and plays with other languages by night (currently Haskell, Scala, Clojure, and Rust). He knows how to laugh at himself and loves to ship software. He is a father of two wonderful kids and a husband to a fantastic wife.</p>
      </div>

      <div class="row">
        <p class="columns">
          <a href="mailto:zach.moazeni@gmail.com">email</a> ϟ <a href="https://github.com/zmoazeni">github</a> ϟ <a href="https://twitter.com/zmoazeni">twitter</a> ϟ <a href="https://www.linkedin.com/in/zmoazeni/">linkedin</a>
        </p>
      </div>

      <h3 class="row columns">Notable Projects</h3>

      <div class="row">
        <ul class="columns">
          <li><a href="http://zmoazeni.github.io/csscss/">csscss</a></li>
          <li><a href="http://zmoazeni.github.io/harvested/">harvested</a></li>
          <li><a href="http://zmoazeni.github.io/gitspective/">gitspective</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row columns">
    <img src="/uploads/me.jpg" alt="Picture of Zach" />
  </div>
</div>

  </div>

  <main class="off-canvas-content" data-off-canvas-content>
    
      <article>
        <div class="header">
          <div class="row">
            <h1 class="column">Detecting Scala Extension Classes at Runtime</h1>
          </div>

          <div class="row">
            <p class="column"><time datetime="2013-12-29T00:00:00+00:00">2013-12-29</time></p>
          </div>
        </div>

        <div class="row align-left">
          <div class="column content">
            <p>Years ago, when I left Java for Ruby and Rails, I found Rails’s opinions on <a href="http://en.wikipedia.org/wiki/Convention_over_configuration">convention over configuration</a> very refreshing. I was tired of all the XML files needed for even the simplest Java architectures.</p>

<p>If you ignore the overengineered uses of XML, there’s still something lacking with Java compared to Ruby when writing extendable software. Technically both languages are interpretted, however Java’s only entry point is the initial <code class="highlighter-rouge">main()</code> method that runs at the begnning. Constrast that with Ruby, where every file that is loaded has the potential for changing the context of the runtime.</p>

<p>Some developers are revolted at Ruby’s flexible nature, and while poorly written code can get squirrely and difficult to understand, I find that open execution context very useful in practice.</p>

<p>After coming back to the JVM and working with Scala, I was beginning to miss this feature from Ruby. Scala has an advantage over Java with its support for interpretting uncompiled files, but loading other uncompiled Scala files outside the REPL is difficult.</p>

<p>Java has some powerful reflection libraries though, both built into the standard library and without. One of these libraries I came across is <a href="https://github.com/ronmamo/reflections">reflections</a> which provides enough tools to make some magic happen. You can check out some <a href="https://github.com/zmoazeni/reflections-example">example reflection code I put together</a>.</p>

<p>The technique is simple.</p>

<ol>
  <li>First we define an <a href="https://github.com/zmoazeni/reflections-example/blob/master/reflections-base/src/main/scala/org/reflections_example/extension/BaseExtension.scala">base interface</a> that becomes an anchor so we can identify extension classes. This example uses a Scala trait, but you could use a Java interface. <em>In my example I also scope all extensions to a particular package for better performance.</em></li>
  <li>We can then separately compile <a href="https://github.com/zmoazeni/reflections-example/blob/master/reflections-extension/src/main/scala/org/reflections_example/extension/MyFirstExtension.scala">a couple</a> <a href="https://github.com/zmoazeni/reflections-example/blob/master/reflections-extension/src/main/scala/org/reflections_example/extension/MySecondExtension.scala">extension classes</a> against our base code that implement that interface.</li>
  <li>Now back in our <code class="highlighter-rouge">main()</code> method, we can use the reflections library to <a href="https://github.com/zmoazeni/reflections-example/blob/master/reflections-base/src/main/scala/org/reflections_example/Main.scala#L9-L13">find any extensions at runtime</a>, instantiate them, and run a common method that we define. This allows our extensions to bootstrap themselves however they need. For example, we could set up <a href="http://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">pubsub</a> in our original code to allow the extensions to modify the program behavior.</li>
</ol>

<p>That’s it. With this pattern you can dynamically extend a program at runtime just by dropping a jar in the classpath.</p>

<p>I suspect the same developers that abhor Ruby’s per-required-file entry points that I described above will also dislike this strategy. But this just opens up the entry points for other code at runtime. You still have to build a design that lets extensions do anything meaningful.</p>

<p>As a concrete application, I’m considering using this for a rewrite of <a href="/blog/2013/04/csscss/">csscss</a>. With this design, I can write a base progam that only deals with CSS, but open up filetype recognition for extensions. Then other developers could write extensions for precompiling <a href="http://sass-lang.com/">SASS</a>, <a href="http://lesscss.org/">LESS</a>, <a href="http://learnboost.github.io/stylus/">Stylus</a> or any other meta CSS language into CSS. And to enable one of those precompilers, a user would only have to download a jar for that extension and put it into a known directory.</p>

<p>No XML files. No configuration. It just works.</p>

          </div>
        </div>
      </article>
    
  </main>

  <footer class="row align-center text-center">
    <p class="column">&copy; 2007-2018 Zach Moazeni</p>
  </footer>

  <script src="/js/main.min.js"></script>
</body>
</html>

