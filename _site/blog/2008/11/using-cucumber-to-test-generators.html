<!DOCTYPE html>
<html lang="en">
<head>
  <title>Using Cucumber to test Generators - Connection Required</title>

  <meta charset="utf-8">
  <meta name="author" content="Zach Moazeni">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/css/main.min.css?v=4" media="screen" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700" rel="stylesheet">
  <link rel="alternate" type="application/atom+xml" title="Connection Required" href="/feed/atom/" />
</head>
<body>
  <header>
    <nav class="row align-center">
      <div class="small-12 columns">
        <a class="brand text-center" href="/"><svg id="svg3542" height="21.913mm" width="168.74mm" version="1.1" viewBox="0 0 597.91431 77.643914">
 <defs id="defs3544">
  <filter id="filter6021" style="color-interpolation-filters:sRGB">
   <feFlood id="feFlood6023" result="flood" flood-opacity=".49804" flood-color="rgb(0,0,0)"/>
   <feComposite id="feComposite6025" operator="in" result="composite1" in2="SourceGraphic" in="flood"/>
   <feGaussianBlur id="feGaussianBlur6027" stdDeviation="3" result="blur" in="composite1"/>
   <feOffset id="feOffset6029" result="offset" dx="6" dy="6"/>
   <feComposite id="feComposite6031" operator="over" result="composite2" in2="offset" in="SourceGraphic"/>
  </filter>
 </defs>
 <g id="layer1" transform="translate(-623.9 295.03)">
  <g id="g6014" transform="translate(-153.57 1274.5)" filter="url(#filter6021)">
   <text id="text3365-6-5-6" style="word-spacing:0px;letter-spacing:0px" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="824.00177" font-family="&apos;Open Sans&apos;" xml:space="preserve"><tspan id="tspan3373-3-1-62" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="824.00177" font-family="&apos;Open Sans&apos;">Connec   ion </tspan></text>
   <path id="path3395-8-6-2-7" d="m1031.5-1538.9-15.848 0.076c-0.3921 0-0.6466-0.5346-0.4683-0.9871l8.7598-22.221c0.2634-0.6681-0.3814-1.314-0.8142-0.8157l-27.274 31.402c-0.35829 0.4126-0.13598 1.1803 0.34336 1.1855l14.468 0.1604c0.3772 0 0.6274 0.508 0.4739 0.9545l-7.3598 21.41c-0.2282 0.6636 0.3997 1.2649 0.8225 0.7874l27.243-30.763c0.3656-0.4127 0.139-1.1922-0.346-1.1899z"/>
   <text id="text3365-9-6-9-7" style="word-spacing:0px;letter-spacing:0px" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="1120.1641" font-family="&apos;Open Sans&apos;" xml:space="preserve"><tspan id="tspan3373-5-4-7-6" font-weight="600" font-size="50px" font-style="italic" y="-1510.3744" x="1120.1641" font-family="&apos;Open Sans&apos;">Required</tspan></text>
  </g>
 </g>
</svg>
 <span>Connection Required</span></a>
      </div>

      <a href="#" class="about" data-toggle="offCanvas" onclick="return false">about</a>
    </nav>
  </header>

  <div class="off-canvas position-left" id="offCanvas" data-off-canvas data-transition="overlap">
    <div class="sidebar">
  <button class="close-button" aria-label="Close menu" type="button" data-close>
    <span aria-hidden="true">&times;</span>
  </button>

  <div class="row">
    <h2 class="columns">About Zach</h2>
  </div>

  <div class="row">
    <div class="columns">
      <div class="row">
        <p class="columns">Zach is a software developer who has worked on a range of projects. He currently writes Ruby by day for <a href="https://www.getharvest.com/">Harvest</a> and plays with other languages by night (currently Haskell, Scala, Clojure, and Rust). He knows how to laugh at himself and loves to ship software. He is a father of two wonderful kids and a husband to a fantastic wife.</p>
      </div>

      <div class="row">
        <p class="columns">
          <a href="mailto:zach.moazeni@gmail.com">email</a> ϟ <a href="https://github.com/zmoazeni">github</a> ϟ <a href="https://twitter.com/zmoazeni">twitter</a> ϟ <a href="https://www.linkedin.com/in/zmoazeni/">linkedin</a>
        </p>
      </div>

      <h3 class="row columns">Notable Projects</h3>

      <div class="row">
        <ul class="columns">
          <li><a href="http://zmoazeni.github.io/csscss/">csscss</a></li>
          <li><a href="http://zmoazeni.github.io/harvested/">harvested</a></li>
          <li><a href="http://zmoazeni.github.io/gitspective/">gitspective</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row columns">
    <img src="/uploads/me.jpg" alt="Picture of Zach" />
  </div>
</div>

  </div>

  <main class="off-canvas-content" data-off-canvas-content>
    
      <article>
        <div class="header">
          <div class="row">
            <h1 class="column">Using Cucumber to test Generators</h1>
          </div>

          <div class="row">
            <p class="column"><time datetime="2008-11-15T06:01:09+00:00">2008-11-15</time></p>
          </div>
        </div>

        <div class="row align-left">
          <div class="column content">
            <p>I’ve been developing in Ruby (and Rails) for the past 2.5 years. Over time, I’ve molded my own flavor of CRUD controllers and resulting specs. Unfortunately, it’s so different than the Rails and RSpec generated code that it takes me as long to alter the code as it does to create it from scratch. However, in laziness, I’ve pushed off writing my own generators. Until yesterday.</p>

<h3 id="the-issue">The Issue</h3>

<p>Now I’m not a big fan of generated code. However I do agree that the templates fit the basic CRUD functionality nicely. Despite their usefulness, one of the things that irks me about generators is making changes and not being confident if the code generated is valid. Parse errors, invalid logic, and variable misspellings are easy examples to get tripped up on. So I wanted these generators to be tested. Sounds odd doesn’t it?</p>

<h3 id="enter-cucumber">Enter Cucumber</h3>

<p><a href="http://github.com/aslakhellesoy/cucumber/wikis">Cucumber</a> is a recent project released that replaces the RSpec Stories Framework. You use it very similarly to the older Stories, but since Cucumber is written with <a href="http://treetop.rubyforge.org/">Treetop</a> it provides a lot more niceties. I won’t give a tutorial of Cucumber here (perhaps in another post), but I do want to illustrate the flexibility of the testing framework.</p>

<p>When first picking up Cucumber, the immediate use that comes to mind is Rails Integration testing (which it is very useful for). However it can also be applied to domains outside of Rails and even web development. When writing these generators I mainly wanted to know: “when I use a generator, is all the code valid, and do all the tests pass?”.</p>

<p>Here’s an example of using Cucumber to describe my intentions:</p>

<p>Feature: Generating Controller Templates
     In order to generate standard CRUD controllers
     A Developer
     Should be able to generate a CRUD controller and the resulting specs</p>

<div class="highlighter-rouge"><pre class="highlight"><code> Scenario: Generating Rails CRUD
   Given I'm using a Rails 2.2 code base
   When I generate 'my_controller customer'
   Then 'app/controllers/customers_controller.rb' should be created
   And 'spec/controllers/customers_controller_spec.rb' should be created
   And all the tests should pass
</code></pre>
</div>

<p>And here’s the backing steps to accomplish the feature:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Given(/^I'm using a (.*) code base$/) do |key|
  key = key.downcase.gsub(" ", "")
  available_codebases = { "rails2.2" =&gt; File.join(codebases_path, "2.2") }
  available_codebases.keys.should include(key)

  blast_and_create_tmp!
  extract_codebase!(key)
  @current_codebase = File.join(tmp_path, key)
end

When /^I generate '(.*)'$/ do |command|
  `#{@current_codebase}/script/generate #{command}`
end

Then /^'(.*)' should be created$/ do |file_path|
  File.exist?(File.join(@current_codebase, file_path)).should be_true
end

Then /^all the tests should pass$/ do
  output = `cd #{@current_codebase} &amp;&amp; rake spec`
  output.should_not match(/\s0 examples/i)
  output.should match(/0 failures/i)
  $?.exitstatus.should == 0
end
</code></pre>
</div>

<p><em>I have all the code in <a href="http://github.com/zmoazeni/my_styles/tree/master">github</a> if you want to see the working example of code.</em></p>

<p>Pretty straightforward and sexy.</p>

          </div>
        </div>
      </article>
    
  </main>

  <footer class="row align-center text-center">
    <p class="column">&copy; 2007-2018 Zach Moazeni</p>
  </footer>

  <script src="/js/main.min.js"></script>
</body>
</html>

